/* 
 * trans.c - Matrix transpose B = A^T
 *
 * Each transpose function must have a prototype of the form:
 * void trans(int M, int N, int A[N][M], int B[M][N]);
 *
 * A transpose function is evaluated by counting the number of misses
 * on a 1KB direct mapped cache with a block size of 32 bytes.
 */ 
#include <stdio.h>
#include "cachelab.h"

int is_transpose(int M, int N, int A[N][M], int B[M][N]);

/* 
 * transpose_submit - This is the solution transpose function that you
 *     will be graded on for Part B of the assignment. Do not change
 *     the description string "Transpose submission", as the driver
 *     searches for that string to identify the transpose function to
 *     be graded. 
 */
char transpose_submit_desc[] = "Transpose submission";
void transpose_submit(int M, int N, int A[N][M], int B[M][N])
{
    if (M == 32) {
		int i, j, k, v1, v2, v3, v4, v5, v6, v7, v8;
        int block = 8;
		for (i = 0; i < N; i += block) {
            for(j = 0; j < M; j += block) {
                if (i == j) {
                    v1 = A[i][j];
                    v2 = A[i][j+1];
                    v3 = A[i][j+2];
                    v4 = A[i][j+3];
                    v5 = A[i][j+4];
                    v6 = A[i][j+5];
                    v7 = A[i][j+6];			
                    v8 = A[i][j+7];
                    B[i][j] = v1;
                    B[i][j+1] = v2;
                    B[i][j+2] = v3;
                    B[i][j+3] = v4;
                    B[i][j+4] = v5;
                    B[i][j+5] = v6;
                    B[i][j+6] = v7;
                    B[i][j+7] = v8;

                    v1 = A[i+1][j];
                    v2 = A[i+1][j+1];
                    v3 = A[i+1][j+2];
                    v4 = A[i+1][j+3];
                    v5 = A[i+1][j+4];
                    v6 = A[i+1][j+5];
                    v7 = A[i+1][j+6];			
                    v8 = A[i+1][j+7];
                    B[i+1][j] = v1;
                    B[i+1][j+1] = v2;
                    B[i+1][j+2] = v3;
                    B[i+1][j+3] = v4;
                    B[i+1][j+4] = v5;
                    B[i+1][j+5] = v6;
                    B[i+1][j+6] = v7;
                    B[i+1][j+7] = v8;

                    v1 = B[i+1][j];
                    B[i+1][j] = B[i][j+1];
                    B[i][j+1] = v1;

                    v1 = A[i+2][j];
                    v2 = A[i+2][j+1];
                    v3 = A[i+2][j+2];
                    v4 = A[i+2][j+3];
                    v5 = A[i+2][j+4];
                    v6 = A[i+2][j+5];
                    v7 = A[i+2][j+6];			
                    v8 = A[i+2][j+7];
                    B[i+2][j] = v1;
                    B[i+2][j+1] = v2;
                    B[i+2][j+2] = v3;
                    B[i+2][j+3] = v4;
                    B[i+2][j+4] = v5;
                    B[i+2][j+5] = v6;
                    B[i+2][j+6] = v7;
                    B[i+2][j+7] = v8;

                    v1 = B[i+2][j];
                    v2 = B[i+2][j+1]; 
                    B[i+2][j] = B[i][j+2];
                    B[i+2][j+1] = B[i+1][j+2];
                    B[i][j+2] = v1;
                    B[i+1][j+2] = v2;

                    v1 = A[i+3][j];
                    v2 = A[i+3][j+1];
                    v3 = A[i+3][j+2];
                    v4 = A[i+3][j+3];
                    v5 = A[i+3][j+4];
                    v6 = A[i+3][j+5];
                    v7 = A[i+3][j+6];			
                    v8 = A[i+3][j+7];
                    B[i+3][j] = v1;
                    B[i+3][j+1] = v2;
                    B[i+3][j+2] = v3;
                    B[i+3][j+3] = v4;
                    B[i+3][j+4] = v5;
                    B[i+3][j+5] = v6;
                    B[i+3][j+6] = v7;
                    B[i+3][j+7] = v8;

                    v1 = B[i+3][j];
                    v2 = B[i+3][j+1];
                    v3 = B[i+3][j+2]; 
                    B[i+3][j] = B[i][j+3];
                    B[i+3][j+1] = B[i+1][j+3];
                    B[i+3][j+2] = B[i+2][j+3];
                    B[i][j+3] = v1;
                    B[i+1][j+3] = v2;
                    B[i+2][j+3] = v3;

                    v1 = A[i+4][j];
                    v2 = A[i+4][j+1];
                    v3 = A[i+4][j+2];
                    v4 = A[i+4][j+3];
                    v5 = A[i+4][j+4];
                    v6 = A[i+4][j+5];
                    v7 = A[i+4][j+6];			
                    v8 = A[i+4][j+7];
                    B[i+4][j] = v1;
                    B[i+4][j+1] = v2;
                    B[i+4][j+2] = v3;
                    B[i+4][j+3] = v4;
                    B[i+4][j+4] = v5;
                    B[i+4][j+5] = v6;
                    B[i+4][j+6] = v7;
                    B[i+4][j+7] = v8;


                    v1 = B[i+4][j];
                    v2 = B[i+4][j+1];
                    v3 = B[i+4][j+2];
                    v4 = B[i+4][j+3]; 
                    B[i+4][j] = B[i][j+4];
                    B[i+4][j+1] = B[i+1][j+4];
                    B[i+4][j+2] = B[i+2][j+4];
                    B[i+4][j+3] = B[i+3][j+4];
                    B[i][j+4] = v1;
                    B[i+1][j+4] = v2;
                    B[i+2][j+4] = v3;
                    B[i+3][j+4] = v4;

                    v1 = A[i+5][j];
                    v2 = A[i+5][j+1];
                    v3 = A[i+5][j+2];
                    v4 = A[i+5][j+3];
                    v5 = A[i+5][j+4];
                    v6 = A[i+5][j+5];
                    v7 = A[i+5][j+6];			
                    v8 = A[i+5][j+7];
                    B[i+5][j] = v1;
                    B[i+5][j+1] = v2;
                    B[i+5][j+2] = v3;
                    B[i+5][j+3] = v4;
                    B[i+5][j+4] = v5;
                    B[i+5][j+5] = v6;
                    B[i+5][j+6] = v7;
                    B[i+5][j+7] = v8;


                    v1 = B[i+5][j];
                    v2 = B[i+5][j+1];
                    v3 = B[i+5][j+2];
                    v4 = B[i+5][j+3]; 
                    v5 = B[i+5][j+4];  
                    B[i+5][j] = B[i][j+5];
                    B[i+5][j+1] = B[i+1][j+5];
                    B[i+5][j+2] = B[i+2][j+5];
                    B[i+5][j+3] = B[i+3][j+5];
                    B[i+5][j+4] = B[i+4][j+5];
                    B[i][j+5] = v1;
                    B[i+1][j+5] = v2;
                    B[i+2][j+5] = v3;
                    B[i+3][j+5] = v4;
                    B[i+4][j+5] = v5; 


                    v1 = A[i+6][j];
                    v2 = A[i+6][j+1];
                    v3 = A[i+6][j+2];
                    v4 = A[i+6][j+3];
                    v5 = A[i+6][j+4];
                    v6 = A[i+6][j+5];
                    v7 = A[i+6][j+6];			
                    v8 = A[i+6][j+7];
                    B[i+6][j] = v1;
                    B[i+6][j+1] = v2;
                    B[i+6][j+2] = v3;
                    B[i+6][j+3] = v4;
                    B[i+6][j+4] = v5;
                    B[i+6][j+5] = v6;
                    B[i+6][j+6] = v7;
                    B[i+6][j+7] = v8;

                    v1 = B[i+6][j];
                    v2 = B[i+6][j+1];
                    v3 = B[i+6][j+2];
                    v4 = B[i+6][j+3]; 
                    v5 = B[i+6][j+4];
                    v6 = B[i+6][j+5]; 
                    B[i+6][j] = B[i][j+6];
                    B[i+6][j+1] = B[i+1][j+6];
                    B[i+6][j+2] = B[i+2][j+6];
                    B[i+6][j+3] = B[i+3][j+6];
                    B[i+6][j+4] = B[i+4][j+6];
                    B[i+6][j+5] = B[i+5][j+6];
                    B[i][j+6] = v1;
                    B[i+1][j+6] = v2;
                    B[i+2][j+6] = v3;
                    B[i+3][j+6] = v4;
                    B[i+4][j+6] = v5;
                    B[i+5][j+6] = v6;  


                    v1 = A[i+7][j];
                    v2 = A[i+7][j+1];
                    v3 = A[i+7][j+2];
                    v4 = A[i+7][j+3];
                    v5 = A[i+7][j+4];
                    v6 = A[i+7][j+5];
                    v7 = A[i+7][j+6];			
                    v8 = A[i+7][j+7];
                    B[i+7][j] = v1;
                    B[i+7][j+1] = v2;
                    B[i+7][j+2] = v3;
                    B[i+7][j+3] = v4;
                    B[i+7][j+4] = v5;
                    B[i+7][j+5] = v6;
                    B[i+7][j+6] = v7;
                    B[i+7][j+7] = v8;

                    v1 = B[i+7][j];
                    v2 = B[i+7][j+1];
                    v3 = B[i+7][j+2];
                    v4 = B[i+7][j+3]; 
                    v5 = B[i+7][j+4];
                    v6 = B[i+7][j+5];
                    v7 = B[i+7][j+6];
                    B[i+7][j] = B[i][j+7];
                    B[i+7][j+1] = B[i+1][j+7];
                    B[i+7][j+2] = B[i+2][j+7];
                    B[i+7][j+3] = B[i+3][j+7];
                    B[i+7][j+4] = B[i+4][j+7];
                    B[i+7][j+5] = B[i+5][j+7];
                    B[i+7][j+6] = B[i+6][j+7];
                    B[i][j+7] = v1;
                    B[i+1][j+7] = v2;
                    B[i+2][j+7] = v3;
                    B[i+3][j+7] = v4;
                    B[i+4][j+7] = v5;
                    B[i+5][j+7] = v6;
                    B[i+6][j+7] = v7;        
                } else {
                    for (k=i; k < (i+8); k++) {
                        v1 = A[k][j];
                        v2 = A[k][j+1];
                        v3 = A[k][j+2];
                        v4 = A[k][j+3];
                        v5 = A[k][j+4];
                        v6 = A[k][j+5];
                        v7 = A[k][j+6];			
                        v8 = A[k][j+7];
                        B[j][k] = v1;
                        B[j+1][k] = v2;
                        B[j+2][k] = v3;
                        B[j+3][k] = v4;
                        B[j+4][k] = v5;
                        B[j+5][k] = v6;
                        B[j+6][k] = v7;
                        B[j+7][k] = v8;
                    }
	            }
            }
        }
    }

    if (M == 64) {
		int i, j, k, v1, v2, v3, v4, v5, v6, v7, v8;
        int block = 8;
        // Step1: 6 * 6
		for (i = 0; i < 48; i += block) {
            for(j = 0; j < 48; j += block) {
                for (k=0; k < 8; k++) {
                    // B set index: b
                    B[56][48 + k] = A[i][j+k];      // A set index: $1 (miss)
                    B[57][48 + k] = A[i+1][j+k];    // A set index: $2 (miss)
                    B[58][48 + k] = A[i+2][j+k];    // A set index: $3 (miss)
                    B[59][48 + k] = A[i+3][j+k];    // A set index: $4 (miss)
                }

                for (k=0; k < 8; k++) {
                    // B set index: c
                    B[56][56 + k] = A[i+4][j+k];      // A set index: $1 (miss)
                    B[57][56 + k] = A[i+5][j+k];    // A set index: $2 (miss)
                    B[58][56 + k] = A[i+6][j+k];    // A set index: $3 (miss)
                    B[59][56 + k] = A[i+7][j+k];    // A set index: $4 (miss)
                }

                // Transpose small blocks (4*4)
                // 1st block
                v1 = B[56][49];
                B[56][49] = B[57][48];
                B[57][48] = v1;
                v1 = B[56][50];
                B[56][50] = B[58][48];
                B[58][48] = v1;
                v1 = B[56][51];
                B[56][51] = B[59][48];
                B[59][48] = v1;
                v1 = B[57][50];
                B[57][50] = B[58][49];
                B[58][49] = v1;
                v1 = B[57][51];
                B[57][51] = B[59][49];
                B[59][49] = v1;
                v1 = B[58][51] ;
                B[58][51] = B[59][50];
                B[59][50] = v1;

                // 2nd block
                v1 = B[56][53];
                B[56][53] = B[57][52];
                B[57][52] = v1;
                v1 = B[56][54];
                B[56][54] = B[58][52];
                B[58][52] = v1;
                v1 = B[56][55];
                B[56][55] = B[59][52];
                B[59][52] = v1;
                v1 = B[57][54];
                B[57][54] = B[58][53];
                B[58][53] = v1;
                v1 = B[57][55];
                B[57][55] = B[59][53];
                B[59][53] = v1;
                v1 = B[58][55] ;
                B[58][55] = B[59][54];
                B[59][54] = v1;

                // 3rd block
                v1 = B[56][57];
                B[56][57] = B[57][56];
                B[57][56] = v1;
                v1 = B[56][58];
                B[56][58] = B[58][56];
                B[58][56] = v1;
                v1 = B[56][59];
                B[56][59] = B[59][56];
                B[59][56] = v1;
                v1 = B[57][58];
                B[57][58] = B[58][57];
                B[58][57] = v1;
                v1 = B[57][59];
                B[57][59] = B[59][57];
                B[59][57] = v1;
                v1 = B[58][59] ;
                B[58][59] = B[59][58];
                B[59][58] = v1;

                // 4th block
                v1 = B[56][61];
                B[56][61] = B[57][60];
                B[57][60] = v1;
                v1 = B[56][62];
                B[56][62] = B[58][60];
                B[58][60] = v1;
                v1 = B[56][63];
                B[56][63] = B[59][60];
                B[59][60] = v1;
                v1 = B[57][62];
                B[57][62] = B[58][61];
                B[58][61] = v1;
                v1 = B[57][63];
                B[57][63] = B[59][61];
                B[59][61] = v1;
                v1 = B[58][63] ;
                B[58][63] = B[59][62];
                B[59][62] = v1;

                // Move to B destination
                B[j][i]   = B[56][48]; B[j][i+1] = B[56][49]; B[j][i+2] = B[56][50]; B[j][i+3] = B[56][51];
                B[j][i+4] = B[56][56]; B[j][i+5] = B[56][57]; B[j][i+6] = B[56][58]; B[j][i+7] = B[56][59];
                B[j+1][i]   = B[57][48]; B[j+1][i+1] = B[57][49]; B[j+1][i+2] = B[57][50]; B[j+1][i+3] = B[57][51];
                B[j+1][i+4] = B[57][56]; B[j+1][i+5] = B[57][57]; B[j+1][i+6] = B[57][58]; B[j+1][i+7] = B[57][59];
                B[j+2][i]   = B[58][48]; B[j+2][i+1] = B[58][49]; B[j+2][i+2] = B[58][50]; B[j+2][i+3] = B[58][51];
                B[j+2][i+4] = B[58][56]; B[j+2][i+5] = B[58][57]; B[j+2][i+6] = B[58][58]; B[j+2][i+7] = B[58][59];
                B[j+3][i]   = B[59][48]; B[j+3][i+1] = B[59][49]; B[j+3][i+2] = B[59][50]; B[j+3][i+3] = B[59][51];
                B[j+3][i+4] = B[59][56]; B[j+3][i+5] = B[59][57]; B[j+3][i+6] = B[59][58]; B[j+3][i+7] = B[59][59];
                // last 4 rows
                B[j+4][i]   = B[56][52]; B[j+4][i+1] = B[56][53]; B[j+4][i+2] = B[56][54]; B[j+4][i+3] = B[56][55];
                B[j+4][i+4] = B[56][60]; B[j+4][i+5] = B[56][61]; B[j+4][i+6] = B[56][62]; B[j+4][i+7] = B[56][63];
                B[j+5][i]   = B[57][52]; B[j+5][i+1] = B[57][53]; B[j+5][i+2] = B[57][54]; B[j+5][i+3] = B[57][55];
                B[j+5][i+4] = B[57][60]; B[j+5][i+5] = B[57][61]; B[j+5][i+6] = B[57][62]; B[j+5][i+7] = B[57][63];
                B[j+6][i]   = B[58][52]; B[j+6][i+1] = B[58][53]; B[j+6][i+2] = B[58][54]; B[j+6][i+3] = B[58][55];
                B[j+6][i+4] = B[58][60]; B[j+6][i+5] = B[58][61]; B[j+6][i+6] = B[58][62]; B[j+6][i+7] = B[58][63];
                B[j+7][i]   = B[59][52]; B[j+7][i+1] = B[59][53]; B[j+7][i+2] = B[59][54]; B[j+7][i+3] = B[59][55];
                B[j+7][i+4] = B[59][60]; B[j+7][i+5] = B[59][61]; B[j+7][i+6] = B[59][62]; B[j+7][i+7] = B[59][63];
            }
        }

        // block[0][6], block[1][6] ~ blcok[4][6]
        j = 48;
        for(i = 0; i < 40; i += block) {
            for (k=0; k < 8; k++) {
                // B set index: b
                B[56][40 + k] = A[i][j+k];      // A set index: $1 (miss)
                B[57][40 + k] = A[i+1][j+k];    // A set index: $2 (miss)
                B[58][40 + k] = A[i+2][j+k];    // A set index: $3 (miss)
                B[59][40 + k] = A[i+3][j+k];    // A set index: $4 (miss)
            }

            for (k=0; k < 8; k++) {
                // B set index: c
                B[56][56 + k] = A[i+4][j+k];      // A set index: $1 (miss)
                B[57][56 + k] = A[i+5][j+k];    // A set index: $2 (miss)
                B[58][56 + k] = A[i+6][j+k];    // A set index: $3 (miss)
                B[59][56 + k] = A[i+7][j+k];    // A set index: $4 (miss)
            }

            // Transpose small blocks (4*4)
            // 1st block
            v1 = B[56][41];
            B[56][41] = B[57][40];
            B[57][40] = v1;
            v1 = B[56][42];
            B[56][42] = B[58][40];
            B[58][40] = v1;
            v1 = B[56][43];
            B[56][43] = B[59][40];
            B[59][40] = v1;
            v1 = B[57][42];
            B[57][42] = B[58][41];
            B[58][41] = v1;
            v1 = B[57][43];
            B[57][43] = B[59][41];
            B[59][41] = v1;
            v1 = B[58][43] ;
            B[58][43] = B[59][42];
            B[59][42] = v1;

            // 2nd block
            v1 = B[56][45];
            B[56][45] = B[57][44];
            B[57][44] = v1;
            v1 = B[56][46];
            B[56][46] = B[58][44];
            B[58][44] = v1;
            v1 = B[56][47];
            B[56][47] = B[59][44];
            B[59][44] = v1;
            v1 = B[57][46];
            B[57][46] = B[58][45];
            B[58][45] = v1;
            v1 = B[57][47];
            B[57][47] = B[59][45];
            B[59][45] = v1;
            v1 = B[58][47] ;
            B[58][47] = B[59][46];
            B[59][46] = v1;

            // 3rd block
            v1 = B[56][57];
            B[56][57] = B[57][56];
            B[57][56] = v1;
            v1 = B[56][58];
            B[56][58] = B[58][56];
            B[58][56] = v1;
            v1 = B[56][59];
            B[56][59] = B[59][56];
            B[59][56] = v1;
            v1 = B[57][58];
            B[57][58] = B[58][57];
            B[58][57] = v1;
            v1 = B[57][59];
            B[57][59] = B[59][57];
            B[59][57] = v1;
            v1 = B[58][59] ;
            B[58][59] = B[59][58];
            B[59][58] = v1;

            // 4th block
            v1 = B[56][61];
            B[56][61] = B[57][60];
            B[57][60] = v1;
            v1 = B[56][62];
            B[56][62] = B[58][60];
            B[58][60] = v1;
            v1 = B[56][63];
            B[56][63] = B[59][60];
            B[59][60] = v1;
            v1 = B[57][62];
            B[57][62] = B[58][61];
            B[58][61] = v1;
            v1 = B[57][63];
            B[57][63] = B[59][61];
            B[59][61] = v1;
            v1 = B[58][63] ;
            B[58][63] = B[59][62];
            B[59][62] = v1;

            // Move to B destination
            B[j][i]   = B[56][40]; B[j][i+1] = B[56][41]; B[j][i+2] = B[56][42]; B[j][i+3] = B[56][43];
            B[j][i+4] = B[56][56]; B[j][i+5] = B[56][57]; B[j][i+6] = B[56][58]; B[j][i+7] = B[56][59];
            B[j+1][i]   = B[57][40]; B[j+1][i+1] = B[57][41]; B[j+1][i+2] = B[57][42]; B[j+1][i+3] = B[57][43];
            B[j+1][i+4] = B[57][56]; B[j+1][i+5] = B[57][57]; B[j+1][i+6] = B[57][58]; B[j+1][i+7] = B[57][59];
            B[j+2][i]   = B[58][40]; B[j+2][i+1] = B[58][41]; B[j+2][i+2] = B[58][42]; B[j+2][i+3] = B[58][43];
            B[j+2][i+4] = B[58][56]; B[j+2][i+5] = B[58][57]; B[j+2][i+6] = B[58][58]; B[j+2][i+7] = B[58][59];
            B[j+3][i]   = B[59][40]; B[j+3][i+1] = B[59][41]; B[j+3][i+2] = B[59][42]; B[j+3][i+3] = B[59][43];
            B[j+3][i+4] = B[59][56]; B[j+3][i+5] = B[59][57]; B[j+3][i+6] = B[59][58]; B[j+3][i+7] = B[59][59];
            // last 4 rows
            B[j+4][i]   = B[56][44]; B[j+4][i+1] = B[56][45]; B[j+4][i+2] = B[56][46]; B[j+4][i+3] = B[56][47];
            B[j+4][i+4] = B[56][60]; B[j+4][i+5] = B[56][61]; B[j+4][i+6] = B[56][62]; B[j+4][i+7] = B[56][63];
            B[j+5][i]   = B[57][44]; B[j+5][i+1] = B[57][45]; B[j+5][i+2] = B[57][46]; B[j+5][i+3] = B[57][47];
            B[j+5][i+4] = B[57][60]; B[j+5][i+5] = B[57][61]; B[j+5][i+6] = B[57][62]; B[j+5][i+7] = B[57][63];
            B[j+6][i]   = B[58][44]; B[j+6][i+1] = B[58][45]; B[j+6][i+2] = B[58][46]; B[j+6][i+3] = B[58][47];
            B[j+6][i+4] = B[58][60]; B[j+6][i+5] = B[58][61]; B[j+6][i+6] = B[58][62]; B[j+6][i+7] = B[58][63];
            B[j+7][i]   = B[59][44]; B[j+7][i+1] = B[59][45]; B[j+7][i+2] = B[59][46]; B[j+7][i+3] = B[59][47];
            B[j+7][i+4] = B[59][60]; B[j+7][i+5] = B[59][61]; B[j+7][i+6] = B[59][62]; B[j+7][i+7] = B[59][63];
        }


        // block[6][0], block[6][1] ~ blcok[6][4]
        i = 48;
        for(j = 0; j < 40; j += block) {
            for (k=0; k < 8; k++) {
                // B set index: b
                B[56][40 + k] = A[i][j+k];      // A set index: $1 (miss)
                B[57][40 + k] = A[i+1][j+k];    // A set index: $2 (miss)
                B[58][40 + k] = A[i+2][j+k];    // A set index: $3 (miss)
                B[59][40 + k] = A[i+3][j+k];    // A set index: $4 (miss)
            }

            for (k=0; k < 8; k++) {
                // B set index: c
                B[56][56 + k] = A[i+4][j+k];      // A set index: $1 (miss)
                B[57][56 + k] = A[i+5][j+k];    // A set index: $2 (miss)
                B[58][56 + k] = A[i+6][j+k];    // A set index: $3 (miss)
                B[59][56 + k] = A[i+7][j+k];    // A set index: $4 (miss)
            }

            // Transpose small blocks (4*4)
            // 1st block
            v1 = B[56][41];
            B[56][41] = B[57][40];
            B[57][40] = v1;
            v1 = B[56][42];
            B[56][42] = B[58][40];
            B[58][40] = v1;
            v1 = B[56][43];
            B[56][43] = B[59][40];
            B[59][40] = v1;
            v1 = B[57][42];
            B[57][42] = B[58][41];
            B[58][41] = v1;
            v1 = B[57][43];
            B[57][43] = B[59][41];
            B[59][41] = v1;
            v1 = B[58][43] ;
            B[58][43] = B[59][42];
            B[59][42] = v1;

            // 2nd block
            v1 = B[56][45];
            B[56][45] = B[57][44];
            B[57][44] = v1;
            v1 = B[56][46];
            B[56][46] = B[58][44];
            B[58][44] = v1;
            v1 = B[56][47];
            B[56][47] = B[59][44];
            B[59][44] = v1;
            v1 = B[57][46];
            B[57][46] = B[58][45];
            B[58][45] = v1;
            v1 = B[57][47];
            B[57][47] = B[59][45];
            B[59][45] = v1;
            v1 = B[58][47] ;
            B[58][47] = B[59][46];
            B[59][46] = v1;

            // 3rd block
            v1 = B[56][57];
            B[56][57] = B[57][56];
            B[57][56] = v1;
            v1 = B[56][58];
            B[56][58] = B[58][56];
            B[58][56] = v1;
            v1 = B[56][59];
            B[56][59] = B[59][56];
            B[59][56] = v1;
            v1 = B[57][58];
            B[57][58] = B[58][57];
            B[58][57] = v1;
            v1 = B[57][59];
            B[57][59] = B[59][57];
            B[59][57] = v1;
            v1 = B[58][59] ;
            B[58][59] = B[59][58];
            B[59][58] = v1;

            // 4th block
            v1 = B[56][61];
            B[56][61] = B[57][60];
            B[57][60] = v1;
            v1 = B[56][62];
            B[56][62] = B[58][60];
            B[58][60] = v1;
            v1 = B[56][63];
            B[56][63] = B[59][60];
            B[59][60] = v1;
            v1 = B[57][62];
            B[57][62] = B[58][61];
            B[58][61] = v1;
            v1 = B[57][63];
            B[57][63] = B[59][61];
            B[59][61] = v1;
            v1 = B[58][63] ;
            B[58][63] = B[59][62];
            B[59][62] = v1;

            // Move to B destination
            B[j][i]   = B[56][40]; B[j][i+1] = B[56][41]; B[j][i+2] = B[56][42]; B[j][i+3] = B[56][43];
            B[j][i+4] = B[56][56]; B[j][i+5] = B[56][57]; B[j][i+6] = B[56][58]; B[j][i+7] = B[56][59];
            B[j+1][i]   = B[57][40]; B[j+1][i+1] = B[57][41]; B[j+1][i+2] = B[57][42]; B[j+1][i+3] = B[57][43];
            B[j+1][i+4] = B[57][56]; B[j+1][i+5] = B[57][57]; B[j+1][i+6] = B[57][58]; B[j+1][i+7] = B[57][59];
            B[j+2][i]   = B[58][40]; B[j+2][i+1] = B[58][41]; B[j+2][i+2] = B[58][42]; B[j+2][i+3] = B[58][43];
            B[j+2][i+4] = B[58][56]; B[j+2][i+5] = B[58][57]; B[j+2][i+6] = B[58][58]; B[j+2][i+7] = B[58][59];
            B[j+3][i]   = B[59][40]; B[j+3][i+1] = B[59][41]; B[j+3][i+2] = B[59][42]; B[j+3][i+3] = B[59][43];
            B[j+3][i+4] = B[59][56]; B[j+3][i+5] = B[59][57]; B[j+3][i+6] = B[59][58]; B[j+3][i+7] = B[59][59];
            // last 4 rows
            B[j+4][i]   = B[56][44]; B[j+4][i+1] = B[56][45]; B[j+4][i+2] = B[56][46]; B[j+4][i+3] = B[56][47];
            B[j+4][i+4] = B[56][60]; B[j+4][i+5] = B[56][61]; B[j+4][i+6] = B[56][62]; B[j+4][i+7] = B[56][63];
            B[j+5][i]   = B[57][44]; B[j+5][i+1] = B[57][45]; B[j+5][i+2] = B[57][46]; B[j+5][i+3] = B[57][47];
            B[j+5][i+4] = B[57][60]; B[j+5][i+5] = B[57][61]; B[j+5][i+6] = B[57][62]; B[j+5][i+7] = B[57][63];
            B[j+6][i]   = B[58][44]; B[j+6][i+1] = B[58][45]; B[j+6][i+2] = B[58][46]; B[j+6][i+3] = B[58][47];
            B[j+6][i+4] = B[58][60]; B[j+6][i+5] = B[58][61]; B[j+6][i+6] = B[58][62]; B[j+6][i+7] = B[58][63];
            B[j+7][i]   = B[59][44]; B[j+7][i+1] = B[59][45]; B[j+7][i+2] = B[59][46]; B[j+7][i+3] = B[59][47];
            B[j+7][i+4] = B[59][60]; B[j+7][i+5] = B[59][61]; B[j+7][i+6] = B[59][62]; B[j+7][i+7] = B[59][63];
        }


        // block[2][7], block[3][7] ~ blcok[7][7]
        j = 56;
        for(i = 16; i < 64; i += block) {
            for (k=0; k < 8; k++) {
                // B set index: b
                B[56][k] = A[i][j+k];      // A set index: $1 (miss)
                B[57][k] = A[i+1][j+k];    // A set index: $2 (miss)
                B[58][k] = A[i+2][j+k];    // A set index: $3 (miss)
                B[59][k] = A[i+3][j+k];    // A set index: $4 (miss)
            }

            for (k=0; k < 8; k++) {
                // B set index: c
                B[56][8 + k] = A[i+4][j+k];    // A set index: $1 (miss)
                B[57][8 + k] = A[i+5][j+k];    // A set index: $2 (miss)
                B[58][8 + k] = A[i+6][j+k];    // A set index: $3 (miss)
                B[59][8 + k] = A[i+7][j+k];    // A set index: $4 (miss)
            }


            // Transpose small blocks (4*4)
            // 1st block
            v1 = B[56][1];
            B[56][1] = B[57][0];
            B[57][0] = v1;
            v1 = B[56][2];
            B[56][2] = B[58][0];
            B[58][0] = v1;
            v1 = B[56][3];
            B[56][3] = B[59][0];
            B[59][0] = v1;
            v1 = B[57][2];
            B[57][2] = B[58][1];
            B[58][1] = v1;
            v1 = B[57][3];
            B[57][3] = B[59][1];
            B[59][1] = v1;
            v1 = B[58][3] ;
            B[58][3] = B[59][2];
            B[59][2] = v1;

            // 2nd block
            v1 = B[56][5];
            B[56][5] = B[57][4];
            B[57][4] = v1;
            v1 = B[56][6];
            B[56][6] = B[58][4];
            B[58][4] = v1;
            v1 = B[56][7];
            B[56][7] = B[59][4];
            B[59][4] = v1;
            v1 = B[57][6];
            B[57][6] = B[58][5];
            B[58][5] = v1;
            v1 = B[57][7];
            B[57][7] = B[59][5];
            B[59][5] = v1;
            v1 = B[58][7] ;
            B[58][7] = B[59][6];
            B[59][6] = v1;

            // 3rd block
            v1 = B[56][9];
            B[56][9] = B[57][8];
            B[57][8] = v1;
            v1 = B[56][10];
            B[56][10] = B[58][8];
            B[58][8] = v1;
            v1 = B[56][11];
            B[56][11] = B[59][8];
            B[59][8] = v1;
            v1 = B[57][10];
            B[57][10] = B[58][9];
            B[58][9] = v1;
            v1 = B[57][11];
            B[57][11] = B[59][9];
            B[59][9] = v1;
            v1 = B[58][11] ;
            B[58][11] = B[59][10];
            B[59][10] = v1;

            // 4th block
            v1 = B[56][13];
            B[56][13] = B[57][12];
            B[57][12] = v1;
            v1 = B[56][14];
            B[56][14] = B[58][12];
            B[58][12] = v1;
            v1 = B[56][15];
            B[56][15] = B[59][12];
            B[59][12] = v1;
            v1 = B[57][14];
            B[57][14] = B[58][13];
            B[58][13] = v1;
            v1 = B[57][15];
            B[57][15] = B[59][13];
            B[59][13] = v1;
            v1 = B[58][15] ;
            B[58][15] = B[59][14];
            B[59][14] = v1;

            // Move to B destination
            B[j][i]   = B[56][0]; B[j][i+1] = B[56][1]; B[j][i+2] = B[56][2]; B[j][i+3] = B[56][3];
            B[j][i+4] = B[56][8]; B[j][i+5] = B[56][9]; B[j][i+6] = B[56][10]; B[j][i+7] = B[56][11];
            B[j+1][i]   = B[57][0]; B[j+1][i+1] = B[57][1]; B[j+1][i+2] = B[57][2]; B[j+1][i+3] = B[57][3];
            B[j+1][i+4] = B[57][8]; B[j+1][i+5] = B[57][9]; B[j+1][i+6] = B[57][10]; B[j+1][i+7] = B[57][11];
            B[j+2][i]   = B[58][0]; B[j+2][i+1] = B[58][1]; B[j+2][i+2] = B[58][2]; B[j+2][i+3] = B[58][3];
            B[j+2][i+4] = B[58][8]; B[j+2][i+5] = B[58][9]; B[j+2][i+6] = B[58][10]; B[j+2][i+7] = B[58][11];
            B[j+3][i]   = B[59][0]; B[j+3][i+1] = B[59][1]; B[j+3][i+2] = B[59][2]; B[j+3][i+3] = B[59][3];
            B[j+3][i+4] = B[59][8]; B[j+3][i+5] = B[59][9]; B[j+3][i+6] = B[59][10]; B[j+3][i+7] = B[59][11];
            // last 4 rows
            B[j+4][i]   = B[56][4]; B[j+4][i+1] = B[56][5]; B[j+4][i+2] = B[56][6]; B[j+4][i+3] = B[56][7];
            B[j+4][i+4] = B[56][12]; B[j+4][i+5] = B[56][13]; B[j+4][i+6] = B[56][14]; B[j+4][i+7] = B[56][15];
            B[j+5][i]   = B[57][4]; B[j+5][i+1] = B[57][5]; B[j+5][i+2] = B[57][6]; B[j+5][i+3] = B[57][7];
            B[j+5][i+4] = B[57][12]; B[j+5][i+5] = B[57][13]; B[j+5][i+6] = B[57][14]; B[j+5][i+7] = B[57][15];
            B[j+6][i]   = B[58][4]; B[j+6][i+1] = B[58][5]; B[j+6][i+2] = B[58][6]; B[j+6][i+3] = B[58][7];
            B[j+6][i+4] = B[58][12]; B[j+6][i+5] = B[58][13]; B[j+6][i+6] = B[58][14]; B[j+6][i+7] = B[58][15];
            B[j+7][i]   = B[59][4]; B[j+7][i+1] = B[59][5]; B[j+7][i+2] = B[59][6]; B[j+7][i+3] = B[59][7];
            B[j+7][i+4] = B[59][12]; B[j+7][i+5] = B[59][13]; B[j+7][i+6] = B[59][14]; B[j+7][i+7] = B[59][15];
        }


        // block[7][2], block[7][3] ~ blcok[7][6]
        i = 56;
        for(j = 16; j < 64; j += block) {
            for (k=0; k < 8; k++) {
                // B set index: b
                B[56][k] = A[i][j+k];      // A set index: $1 (miss)
                B[57][k] = A[i+1][j+k];    // A set index: $2 (miss)
                B[58][k] = A[i+2][j+k];    // A set index: $3 (miss)
                B[59][k] = A[i+3][j+k];    // A set index: $4 (miss)
            }

            for (k=0; k < 8; k++) {
                // B set index: c
                B[56][8 + k] = A[i+4][j+k];    // A set index: $1 (miss)
                B[57][8 + k] = A[i+5][j+k];    // A set index: $2 (miss)
                B[58][8 + k] = A[i+6][j+k];    // A set index: $3 (miss)
                B[59][8 + k] = A[i+7][j+k];    // A set index: $4 (miss)
            }

            // Transpose small blocks (4*4)
            // 1st block
            v1 = B[56][1];
            B[56][1] = B[57][0];
            B[57][0] = v1;
            v1 = B[56][2];
            B[56][2] = B[58][0];
            B[58][0] = v1;
            v1 = B[56][3];
            B[56][3] = B[59][0];
            B[59][0] = v1;
            v1 = B[57][2];
            B[57][2] = B[58][1];
            B[58][1] = v1;
            v1 = B[57][3];
            B[57][3] = B[59][1];
            B[59][1] = v1;
            v1 = B[58][3] ;
            B[58][3] = B[59][2];
            B[59][2] = v1;

            // 2nd block
            v1 = B[56][5];
            B[56][5] = B[57][4];
            B[57][4] = v1;
            v1 = B[56][6];
            B[56][6] = B[58][4];
            B[58][4] = v1;
            v1 = B[56][7];
            B[56][7] = B[59][4];
            B[59][4] = v1;
            v1 = B[57][6];
            B[57][6] = B[58][5];
            B[58][5] = v1;
            v1 = B[57][7];
            B[57][7] = B[59][5];
            B[59][5] = v1;
            v1 = B[58][7] ;
            B[58][7] = B[59][6];
            B[59][6] = v1;

            // 3rd block
            v1 = B[56][9];
            B[56][9] = B[57][8];
            B[57][8] = v1;
            v1 = B[56][10];
            B[56][10] = B[58][8];
            B[58][8] = v1;
            v1 = B[56][11];
            B[56][11] = B[59][8];
            B[59][8] = v1;
            v1 = B[57][10];
            B[57][10] = B[58][9];
            B[58][9] = v1;
            v1 = B[57][11];
            B[57][11] = B[59][9];
            B[59][9] = v1;
            v1 = B[58][11] ;
            B[58][11] = B[59][10];
            B[59][10] = v1;

            // 4th block
            v1 = B[56][13];
            B[56][13] = B[57][12];
            B[57][12] = v1;
            v1 = B[56][14];
            B[56][14] = B[58][12];
            B[58][12] = v1;
            v1 = B[56][15];
            B[56][15] = B[59][12];
            B[59][12] = v1;
            v1 = B[57][14];
            B[57][14] = B[58][13];
            B[58][13] = v1;
            v1 = B[57][15];
            B[57][15] = B[59][13];
            B[59][13] = v1;
            v1 = B[58][15] ;
            B[58][15] = B[59][14];
            B[59][14] = v1;

            // Move to B destination
            B[j][i]   = B[56][0]; B[j][i+1] = B[56][1]; B[j][i+2] = B[56][2]; B[j][i+3] = B[56][3];
            B[j][i+4] = B[56][8]; B[j][i+5] = B[56][9]; B[j][i+6] = B[56][10]; B[j][i+7] = B[56][11];
            B[j+1][i]   = B[57][0]; B[j+1][i+1] = B[57][1]; B[j+1][i+2] = B[57][2]; B[j+1][i+3] = B[57][3];
            B[j+1][i+4] = B[57][8]; B[j+1][i+5] = B[57][9]; B[j+1][i+6] = B[57][10]; B[j+1][i+7] = B[57][11];
            B[j+2][i]   = B[58][0]; B[j+2][i+1] = B[58][1]; B[j+2][i+2] = B[58][2]; B[j+2][i+3] = B[58][3];
            B[j+2][i+4] = B[58][8]; B[j+2][i+5] = B[58][9]; B[j+2][i+6] = B[58][10]; B[j+2][i+7] = B[58][11];
            B[j+3][i]   = B[59][0]; B[j+3][i+1] = B[59][1]; B[j+3][i+2] = B[59][2]; B[j+3][i+3] = B[59][3];
            B[j+3][i+4] = B[59][8]; B[j+3][i+5] = B[59][9]; B[j+3][i+6] = B[59][10]; B[j+3][i+7] = B[59][11];
            // last 4 rows
            B[j+4][i]   = B[56][4]; B[j+4][i+1] = B[56][5]; B[j+4][i+2] = B[56][6]; B[j+4][i+3] = B[56][7];
            B[j+4][i+4] = B[56][12]; B[j+4][i+5] = B[56][13]; B[j+4][i+6] = B[56][14]; B[j+4][i+7] = B[56][15];
            B[j+5][i]   = B[57][4]; B[j+5][i+1] = B[57][5]; B[j+5][i+2] = B[57][6]; B[j+5][i+3] = B[57][7];
            B[j+5][i+4] = B[57][12]; B[j+5][i+5] = B[57][13]; B[j+5][i+6] = B[57][14]; B[j+5][i+7] = B[57][15];
            B[j+6][i]   = B[58][4]; B[j+6][i+1] = B[58][5]; B[j+6][i+2] = B[58][6]; B[j+6][i+3] = B[58][7];
            B[j+6][i+4] = B[58][12]; B[j+6][i+5] = B[58][13]; B[j+6][i+6] = B[58][14]; B[j+6][i+7] = B[58][15];
            B[j+7][i]   = B[59][4]; B[j+7][i+1] = B[59][5]; B[j+7][i+2] = B[59][6]; B[j+7][i+3] = B[59][7];
            B[j+7][i+4] = B[59][12]; B[j+7][i+5] = B[59][13]; B[j+7][i+6] = B[59][14]; B[j+7][i+7] = B[59][15];
        }

        // block[5][6]
        i = 40;
        for(j = 48; j < 56; j += block) {
            for (k=0; k < 8; k++) {
                // B set index: b
                B[56][k] = A[i][j+k];      // A set index: $1 (miss)
                B[57][k] = A[i+1][j+k];    // A set index: $2 (miss)
                B[58][k] = A[i+2][j+k];    // A set index: $3 (miss)
                B[59][k] = A[i+3][j+k];    // A set index: $4 (miss)
            }

            for (k=0; k < 8; k++) {
                // B set index: c
                B[56][8 + k] = A[i+4][j+k];    // A set index: $1 (miss)
                B[57][8 + k] = A[i+5][j+k];    // A set index: $2 (miss)
                B[58][8 + k] = A[i+6][j+k];    // A set index: $3 (miss)
                B[59][8 + k] = A[i+7][j+k];    // A set index: $4 (miss)
            }

            // Transpose small blocks (4*4)
            // 1st block
            v1 = B[56][1];
            B[56][1] = B[57][0];
            B[57][0] = v1;
            v1 = B[56][2];
            B[56][2] = B[58][0];
            B[58][0] = v1;
            v1 = B[56][3];
            B[56][3] = B[59][0];
            B[59][0] = v1;
            v1 = B[57][2];
            B[57][2] = B[58][1];
            B[58][1] = v1;
            v1 = B[57][3];
            B[57][3] = B[59][1];
            B[59][1] = v1;
            v1 = B[58][3] ;
            B[58][3] = B[59][2];
            B[59][2] = v1;

            // 2nd block
            v1 = B[56][5];
            B[56][5] = B[57][4];
            B[57][4] = v1;
            v1 = B[56][6];
            B[56][6] = B[58][4];
            B[58][4] = v1;
            v1 = B[56][7];
            B[56][7] = B[59][4];
            B[59][4] = v1;
            v1 = B[57][6];
            B[57][6] = B[58][5];
            B[58][5] = v1;
            v1 = B[57][7];
            B[57][7] = B[59][5];
            B[59][5] = v1;
            v1 = B[58][7] ;
            B[58][7] = B[59][6];
            B[59][6] = v1;

            // 3rd block
            v1 = B[56][9];
            B[56][9] = B[57][8];
            B[57][8] = v1;
            v1 = B[56][10];
            B[56][10] = B[58][8];
            B[58][8] = v1;
            v1 = B[56][11];
            B[56][11] = B[59][8];
            B[59][8] = v1;
            v1 = B[57][10];
            B[57][10] = B[58][9];
            B[58][9] = v1;
            v1 = B[57][11];
            B[57][11] = B[59][9];
            B[59][9] = v1;
            v1 = B[58][11] ;
            B[58][11] = B[59][10];
            B[59][10] = v1;

            // 4th block
            v1 = B[56][13];
            B[56][13] = B[57][12];
            B[57][12] = v1;
            v1 = B[56][14];
            B[56][14] = B[58][12];
            B[58][12] = v1;
            v1 = B[56][15];
            B[56][15] = B[59][12];
            B[59][12] = v1;
            v1 = B[57][14];
            B[57][14] = B[58][13];
            B[58][13] = v1;
            v1 = B[57][15];
            B[57][15] = B[59][13];
            B[59][13] = v1;
            v1 = B[58][15] ;
            B[58][15] = B[59][14];
            B[59][14] = v1;

            // Move to B destination
            B[j][i]   = B[56][0]; B[j][i+1] = B[56][1]; B[j][i+2] = B[56][2]; B[j][i+3] = B[56][3];
            B[j][i+4] = B[56][8]; B[j][i+5] = B[56][9]; B[j][i+6] = B[56][10]; B[j][i+7] = B[56][11];
            B[j+1][i]   = B[57][0]; B[j+1][i+1] = B[57][1]; B[j+1][i+2] = B[57][2]; B[j+1][i+3] = B[57][3];
            B[j+1][i+4] = B[57][8]; B[j+1][i+5] = B[57][9]; B[j+1][i+6] = B[57][10]; B[j+1][i+7] = B[57][11];
            B[j+2][i]   = B[58][0]; B[j+2][i+1] = B[58][1]; B[j+2][i+2] = B[58][2]; B[j+2][i+3] = B[58][3];
            B[j+2][i+4] = B[58][8]; B[j+2][i+5] = B[58][9]; B[j+2][i+6] = B[58][10]; B[j+2][i+7] = B[58][11];
            B[j+3][i]   = B[59][0]; B[j+3][i+1] = B[59][1]; B[j+3][i+2] = B[59][2]; B[j+3][i+3] = B[59][3];
            B[j+3][i+4] = B[59][8]; B[j+3][i+5] = B[59][9]; B[j+3][i+6] = B[59][10]; B[j+3][i+7] = B[59][11];
            // last 4 rows
            B[j+4][i]   = B[56][4]; B[j+4][i+1] = B[56][5]; B[j+4][i+2] = B[56][6]; B[j+4][i+3] = B[56][7];
            B[j+4][i+4] = B[56][12]; B[j+4][i+5] = B[56][13]; B[j+4][i+6] = B[56][14]; B[j+4][i+7] = B[56][15];
            B[j+5][i]   = B[57][4]; B[j+5][i+1] = B[57][5]; B[j+5][i+2] = B[57][6]; B[j+5][i+3] = B[57][7];
            B[j+5][i+4] = B[57][12]; B[j+5][i+5] = B[57][13]; B[j+5][i+6] = B[57][14]; B[j+5][i+7] = B[57][15];
            B[j+6][i]   = B[58][4]; B[j+6][i+1] = B[58][5]; B[j+6][i+2] = B[58][6]; B[j+6][i+3] = B[58][7];
            B[j+6][i+4] = B[58][12]; B[j+6][i+5] = B[58][13]; B[j+6][i+6] = B[58][14]; B[j+6][i+7] = B[58][15];
            B[j+7][i]   = B[59][4]; B[j+7][i+1] = B[59][5]; B[j+7][i+2] = B[59][6]; B[j+7][i+3] = B[59][7];
            B[j+7][i+4] = B[59][12]; B[j+7][i+5] = B[59][13]; B[j+7][i+6] = B[59][14]; B[j+7][i+7] = B[59][15];
        }


        // block[6][5]
        i = 48;
        for(j = 40; j < 48; j += block) {
            for (k=0; k < 8; k++) {
                // B set index: b
                B[56][k] = A[i][j+k];      // A set index: $1 (miss)
                B[57][k] = A[i+1][j+k];    // A set index: $2 (miss)
                B[58][k] = A[i+2][j+k];    // A set index: $3 (miss)
                B[59][k] = A[i+3][j+k];    // A set index: $4 (miss)
            }

            for (k=0; k < 8; k++) {
                // B set index: c
                B[56][8 + k] = A[i+4][j+k];    // A set index: $1 (miss)
                B[57][8 + k] = A[i+5][j+k];    // A set index: $2 (miss)
                B[58][8 + k] = A[i+6][j+k];    // A set index: $3 (miss)
                B[59][8 + k] = A[i+7][j+k];    // A set index: $4 (miss)
            }

            // Transpose small blocks (4*4)
            // 1st block
            v1 = B[56][1];
            B[56][1] = B[57][0];
            B[57][0] = v1;
            v1 = B[56][2];
            B[56][2] = B[58][0];
            B[58][0] = v1;
            v1 = B[56][3];
            B[56][3] = B[59][0];
            B[59][0] = v1;
            v1 = B[57][2];
            B[57][2] = B[58][1];
            B[58][1] = v1;
            v1 = B[57][3];
            B[57][3] = B[59][1];
            B[59][1] = v1;
            v1 = B[58][3] ;
            B[58][3] = B[59][2];
            B[59][2] = v1;

            // 2nd block
            v1 = B[56][5];
            B[56][5] = B[57][4];
            B[57][4] = v1;
            v1 = B[56][6];
            B[56][6] = B[58][4];
            B[58][4] = v1;
            v1 = B[56][7];
            B[56][7] = B[59][4];
            B[59][4] = v1;
            v1 = B[57][6];
            B[57][6] = B[58][5];
            B[58][5] = v1;
            v1 = B[57][7];
            B[57][7] = B[59][5];
            B[59][5] = v1;
            v1 = B[58][7] ;
            B[58][7] = B[59][6];
            B[59][6] = v1;

            // 3rd block
            v1 = B[56][9];
            B[56][9] = B[57][8];
            B[57][8] = v1;
            v1 = B[56][10];
            B[56][10] = B[58][8];
            B[58][8] = v1;
            v1 = B[56][11];
            B[56][11] = B[59][8];
            B[59][8] = v1;
            v1 = B[57][10];
            B[57][10] = B[58][9];
            B[58][9] = v1;
            v1 = B[57][11];
            B[57][11] = B[59][9];
            B[59][9] = v1;
            v1 = B[58][11] ;
            B[58][11] = B[59][10];
            B[59][10] = v1;

            // 4th block
            v1 = B[56][13];
            B[56][13] = B[57][12];
            B[57][12] = v1;
            v1 = B[56][14];
            B[56][14] = B[58][12];
            B[58][12] = v1;
            v1 = B[56][15];
            B[56][15] = B[59][12];
            B[59][12] = v1;
            v1 = B[57][14];
            B[57][14] = B[58][13];
            B[58][13] = v1;
            v1 = B[57][15];
            B[57][15] = B[59][13];
            B[59][13] = v1;
            v1 = B[58][15] ;
            B[58][15] = B[59][14];
            B[59][14] = v1;

            // Move to B destination
            B[j][i]   = B[56][0]; B[j][i+1] = B[56][1]; B[j][i+2] = B[56][2]; B[j][i+3] = B[56][3];
            B[j][i+4] = B[56][8]; B[j][i+5] = B[56][9]; B[j][i+6] = B[56][10]; B[j][i+7] = B[56][11];
            B[j+1][i]   = B[57][0]; B[j+1][i+1] = B[57][1]; B[j+1][i+2] = B[57][2]; B[j+1][i+3] = B[57][3];
            B[j+1][i+4] = B[57][8]; B[j+1][i+5] = B[57][9]; B[j+1][i+6] = B[57][10]; B[j+1][i+7] = B[57][11];
            B[j+2][i]   = B[58][0]; B[j+2][i+1] = B[58][1]; B[j+2][i+2] = B[58][2]; B[j+2][i+3] = B[58][3];
            B[j+2][i+4] = B[58][8]; B[j+2][i+5] = B[58][9]; B[j+2][i+6] = B[58][10]; B[j+2][i+7] = B[58][11];
            B[j+3][i]   = B[59][0]; B[j+3][i+1] = B[59][1]; B[j+3][i+2] = B[59][2]; B[j+3][i+3] = B[59][3];
            B[j+3][i+4] = B[59][8]; B[j+3][i+5] = B[59][9]; B[j+3][i+6] = B[59][10]; B[j+3][i+7] = B[59][11];
            // last 4 rows
            B[j+4][i]   = B[56][4]; B[j+4][i+1] = B[56][5]; B[j+4][i+2] = B[56][6]; B[j+4][i+3] = B[56][7];
            B[j+4][i+4] = B[56][12]; B[j+4][i+5] = B[56][13]; B[j+4][i+6] = B[56][14]; B[j+4][i+7] = B[56][15];
            B[j+5][i]   = B[57][4]; B[j+5][i+1] = B[57][5]; B[j+5][i+2] = B[57][6]; B[j+5][i+3] = B[57][7];
            B[j+5][i+4] = B[57][12]; B[j+5][i+5] = B[57][13]; B[j+5][i+6] = B[57][14]; B[j+5][i+7] = B[57][15];
            B[j+6][i]   = B[58][4]; B[j+6][i+1] = B[58][5]; B[j+6][i+2] = B[58][6]; B[j+6][i+3] = B[58][7];
            B[j+6][i+4] = B[58][12]; B[j+6][i+5] = B[58][13]; B[j+6][i+6] = B[58][14]; B[j+6][i+7] = B[58][15];
            B[j+7][i]   = B[59][4]; B[j+7][i+1] = B[59][5]; B[j+7][i+2] = B[59][6]; B[j+7][i+3] = B[59][7];
            B[j+7][i+4] = B[59][12]; B[j+7][i+5] = B[59][13]; B[j+7][i+6] = B[59][14]; B[j+7][i+7] = B[59][15];
        }


        // block[1][7]
        i = 8;
        for(j = 56; j < 64; j += block) {
            for (k=0; k < 8; k++) {
                // B set index: b
                B[56][k] = A[i][j+k];      // A set index: $1 (miss)
                B[57][k] = A[i+1][j+k];    // A set index: $2 (miss)
                B[58][k] = A[i+2][j+k];    // A set index: $3 (miss)
                B[59][k] = A[i+3][j+k];    // A set index: $4 (miss)
            }

            for (k=0; k < 8; k++) {
                // B set index: c
                B[48][48 + k] = A[i+4][j+k];    // A set index: $1 (miss)
                B[49][48 + k] = A[i+5][j+k];    // A set index: $2 (miss)
                B[50][48 + k] = A[i+6][j+k];    // A set index: $3 (miss)
                B[51][48 + k] = A[i+7][j+k];    // A set index: $4 (miss)
            }

            // Transpose small blocks (4*4)
            // 1st block
            v1 = B[56][1];
            B[56][1] = B[57][0];
            B[57][0] = v1;
            v1 = B[56][2];
            B[56][2] = B[58][0];
            B[58][0] = v1;
            v1 = B[56][3];
            B[56][3] = B[59][0];
            B[59][0] = v1;
            v1 = B[57][2];
            B[57][2] = B[58][1];
            B[58][1] = v1;
            v1 = B[57][3];
            B[57][3] = B[59][1];
            B[59][1] = v1;
            v1 = B[58][3] ;
            B[58][3] = B[59][2];
            B[59][2] = v1;

            // 2nd block
            v1 = B[56][5];
            B[56][5] = B[57][4];
            B[57][4] = v1;
            v1 = B[56][6];
            B[56][6] = B[58][4];
            B[58][4] = v1;
            v1 = B[56][7];
            B[56][7] = B[59][4];
            B[59][4] = v1;
            v1 = B[57][6];
            B[57][6] = B[58][5];
            B[58][5] = v1;
            v1 = B[57][7];
            B[57][7] = B[59][5];
            B[59][5] = v1;
            v1 = B[58][7] ;
            B[58][7] = B[59][6];
            B[59][6] = v1;

            // 3rd block
            v1 = B[48][49];
            B[48][49] = B[49][48];
            B[49][48] = v1;
            v1 = B[48][50];
            B[48][50] = B[50][48];
            B[50][48] = v1;
            v1 = B[48][51];
            B[48][51] = B[51][48];
            B[51][48] = v1;
            v1 = B[49][50];
            B[49][50] = B[50][49];
            B[50][49] = v1;
            v1 = B[49][51];
            B[49][51] = B[51][49];
            B[51][49] = v1;
            v1 = B[50][51] ;
            B[50][51] = B[51][50];
            B[51][50] = v1;

            // 4th block
            v1 = B[48][53];
            B[48][53] = B[49][52];
            B[49][52] = v1;
            v1 = B[48][54];
            B[48][54] = B[50][52];
            B[50][52] = v1;
            v1 = B[48][55];
            B[48][55] = B[51][52];
            B[51][52] = v1;
            v1 = B[49][54];
            B[49][54] = B[50][53];
            B[50][53] = v1;
            v1 = B[49][55];
            B[49][55] = B[51][53];
            B[51][53] = v1;
            v1 = B[50][55] ;
            B[50][55] = B[51][54];
            B[51][54] = v1;

            // Move to B destination
            B[j][i]   = B[56][0]; B[j][i+1] = B[56][1]; B[j][i+2] = B[56][2]; B[j][i+3] = B[56][3];
            B[j][i+4] = B[48][48]; B[j][i+5] = B[48][49]; B[j][i+6] = B[48][50]; B[j][i+7] = B[48][51];
            B[j+1][i]   = B[57][0]; B[j+1][i+1] = B[57][1]; B[j+1][i+2] = B[57][2]; B[j+1][i+3] = B[57][3];
            B[j+1][i+4] = B[49][48]; B[j+1][i+5] = B[49][49]; B[j+1][i+6] = B[49][50]; B[j+1][i+7] = B[49][51];
            B[j+2][i]   = B[58][0]; B[j+2][i+1] = B[58][1]; B[j+2][i+2] = B[58][2]; B[j+2][i+3] = B[58][3];
            B[j+2][i+4] = B[50][48]; B[j+2][i+5] = B[50][49]; B[j+2][i+6] = B[50][50]; B[j+2][i+7] = B[50][51];
            B[j+3][i]   = B[59][0]; B[j+3][i+1] = B[59][1]; B[j+3][i+2] = B[59][2]; B[j+3][i+3] = B[59][3];
            B[j+3][i+4] = B[51][48]; B[j+3][i+5] = B[51][49]; B[j+3][i+6] = B[51][50]; B[j+3][i+7] = B[51][51];
            // last 4 rows
            B[j+4][i]   = B[56][4]; B[j+4][i+1] = B[56][5]; B[j+4][i+2] = B[56][6]; B[j+4][i+3] = B[56][7];
            B[j+4][i+4] = B[48][52]; B[j+4][i+5] = B[48][53]; B[j+4][i+6] = B[48][54]; B[j+4][i+7] = B[48][55];
            B[j+5][i]   = B[57][4]; B[j+5][i+1] = B[57][5]; B[j+5][i+2] = B[57][6]; B[j+5][i+3] = B[57][7];
            B[j+5][i+4] = B[49][52]; B[j+5][i+5] = B[49][53]; B[j+5][i+6] = B[49][54]; B[j+5][i+7] = B[49][55];
            B[j+6][i]   = B[58][4]; B[j+6][i+1] = B[58][5]; B[j+6][i+2] = B[58][6]; B[j+6][i+3] = B[58][7];
            B[j+6][i+4] = B[50][52]; B[j+6][i+5] = B[50][53]; B[j+6][i+6] = B[50][54]; B[j+6][i+7] = B[50][55];
            B[j+7][i]   = B[59][4]; B[j+7][i+1] = B[59][5]; B[j+7][i+2] = B[59][6]; B[j+7][i+3] = B[59][7];
            B[j+7][i+4] = B[51][52]; B[j+7][i+5] = B[51][53]; B[j+7][i+6] = B[51][54]; B[j+7][i+7] = B[51][55];
        }

        // block[7][0], block[7][1]
        i = 56;
        for(j = 0; j < 16; j += block) {
            for (k=0; k < 8; k++) {
                // B set index: b
                B[56][k] = A[i][j+k];      // A set index: $1 (miss)
                B[57][k] = A[i+1][j+k];    // A set index: $2 (miss)
                B[58][k] = A[i+2][j+k];    // A set index: $3 (miss)
                B[59][k] = A[i+3][j+k];    // A set index: $4 (miss)
            }

            for (k=0; k < 8; k++) {
                // B set index: c
                B[48][48 + k] = A[i+4][j+k];    // A set index: $1 (miss)
                B[49][48 + k] = A[i+5][j+k];    // A set index: $2 (miss)
                B[50][48 + k] = A[i+6][j+k];    // A set index: $3 (miss)
                B[51][48 + k] = A[i+7][j+k];    // A set index: $4 (miss)
            }

            // Transpose small blocks (4*4)
            // 1st block
            v1 = B[56][1];
            B[56][1] = B[57][0];
            B[57][0] = v1;
            v1 = B[56][2];
            B[56][2] = B[58][0];
            B[58][0] = v1;
            v1 = B[56][3];
            B[56][3] = B[59][0];
            B[59][0] = v1;
            v1 = B[57][2];
            B[57][2] = B[58][1];
            B[58][1] = v1;
            v1 = B[57][3];
            B[57][3] = B[59][1];
            B[59][1] = v1;
            v1 = B[58][3] ;
            B[58][3] = B[59][2];
            B[59][2] = v1;

            // 2nd block
            v1 = B[56][5];
            B[56][5] = B[57][4];
            B[57][4] = v1;
            v1 = B[56][6];
            B[56][6] = B[58][4];
            B[58][4] = v1;
            v1 = B[56][7];
            B[56][7] = B[59][4];
            B[59][4] = v1;
            v1 = B[57][6];
            B[57][6] = B[58][5];
            B[58][5] = v1;
            v1 = B[57][7];
            B[57][7] = B[59][5];
            B[59][5] = v1;
            v1 = B[58][7] ;
            B[58][7] = B[59][6];
            B[59][6] = v1;

            // 3rd block
            v1 = B[48][49];
            B[48][49] = B[49][48];
            B[49][48] = v1;
            v1 = B[48][50];
            B[48][50] = B[50][48];
            B[50][48] = v1;
            v1 = B[48][51];
            B[48][51] = B[51][48];
            B[51][48] = v1;
            v1 = B[49][50];
            B[49][50] = B[50][49];
            B[50][49] = v1;
            v1 = B[49][51];
            B[49][51] = B[51][49];
            B[51][49] = v1;
            v1 = B[50][51] ;
            B[50][51] = B[51][50];
            B[51][50] = v1;

            // 4th block
            v1 = B[48][53];
            B[48][53] = B[49][52];
            B[49][52] = v1;
            v1 = B[48][54];
            B[48][54] = B[50][52];
            B[50][52] = v1;
            v1 = B[48][55];
            B[48][55] = B[51][52];
            B[51][52] = v1;
            v1 = B[49][54];
            B[49][54] = B[50][53];
            B[50][53] = v1;
            v1 = B[49][55];
            B[49][55] = B[51][53];
            B[51][53] = v1;
            v1 = B[50][55] ;
            B[50][55] = B[51][54];
            B[51][54] = v1;

            // Move to B destination
            B[j][i]   = B[56][0]; B[j][i+1] = B[56][1]; B[j][i+2] = B[56][2]; B[j][i+3] = B[56][3];
            B[j][i+4] = B[48][48]; B[j][i+5] = B[48][49]; B[j][i+6] = B[48][50]; B[j][i+7] = B[48][51];
            B[j+1][i]   = B[57][0]; B[j+1][i+1] = B[57][1]; B[j+1][i+2] = B[57][2]; B[j+1][i+3] = B[57][3];
            B[j+1][i+4] = B[49][48]; B[j+1][i+5] = B[49][49]; B[j+1][i+6] = B[49][50]; B[j+1][i+7] = B[49][51];
            B[j+2][i]   = B[58][0]; B[j+2][i+1] = B[58][1]; B[j+2][i+2] = B[58][2]; B[j+2][i+3] = B[58][3];
            B[j+2][i+4] = B[50][48]; B[j+2][i+5] = B[50][49]; B[j+2][i+6] = B[50][50]; B[j+2][i+7] = B[50][51];
            B[j+3][i]   = B[59][0]; B[j+3][i+1] = B[59][1]; B[j+3][i+2] = B[59][2]; B[j+3][i+3] = B[59][3];
            B[j+3][i+4] = B[51][48]; B[j+3][i+5] = B[51][49]; B[j+3][i+6] = B[51][50]; B[j+3][i+7] = B[51][51];
            // last 4 rows
            B[j+4][i]   = B[56][4]; B[j+4][i+1] = B[56][5]; B[j+4][i+2] = B[56][6]; B[j+4][i+3] = B[56][7];
            B[j+4][i+4] = B[48][52]; B[j+4][i+5] = B[48][53]; B[j+4][i+6] = B[48][54]; B[j+4][i+7] = B[48][55];
            B[j+5][i]   = B[57][4]; B[j+5][i+1] = B[57][5]; B[j+5][i+2] = B[57][6]; B[j+5][i+3] = B[57][7];
            B[j+5][i+4] = B[49][52]; B[j+5][i+5] = B[49][53]; B[j+5][i+6] = B[49][54]; B[j+5][i+7] = B[49][55];
            B[j+6][i]   = B[58][4]; B[j+6][i+1] = B[58][5]; B[j+6][i+2] = B[58][6]; B[j+6][i+3] = B[58][7];
            B[j+6][i+4] = B[50][52]; B[j+6][i+5] = B[50][53]; B[j+6][i+6] = B[50][54]; B[j+6][i+7] = B[50][55];
            B[j+7][i]   = B[59][4]; B[j+7][i+1] = B[59][5]; B[j+7][i+2] = B[59][6]; B[j+7][i+3] = B[59][7];
            B[j+7][i+4] = B[51][52]; B[j+7][i+5] = B[51][53]; B[j+7][i+6] = B[51][54]; B[j+7][i+7] = B[51][55];
        }

        // block[0][7]
        j = 56;
        for(i = 0; i < 8; i += block) {
            for (k=0; k < 8; k++) {
                // B set index: b
                B[56][k] = A[i][j+k];      // A set index: $1 (miss)
                B[57][k] = A[i+1][j+k];    // A set index: $2 (miss)
                B[58][k] = A[i+2][j+k];    // A set index: $3 (miss)
                B[59][k] = A[i+3][j+k];    // A set index: $4 (miss)
            }

            for (k=0; k < 8; k++) {
                // B set index: c
                B[48][48 + k] = A[i+4][j+k];    // A set index: $1 (miss)
                B[49][48 + k] = A[i+5][j+k];    // A set index: $2 (miss)
                B[50][48 + k] = A[i+6][j+k];    // A set index: $3 (miss)
                B[51][48 + k] = A[i+7][j+k];    // A set index: $4 (miss)
            }

            // Transpose small blocks (4*4)
            // 1st block
            v1 = B[56][1];
            B[56][1] = B[57][0];
            B[57][0] = v1;
            v1 = B[56][2];
            B[56][2] = B[58][0];
            B[58][0] = v1;
            v1 = B[56][3];
            B[56][3] = B[59][0];
            B[59][0] = v1;
            v1 = B[57][2];
            B[57][2] = B[58][1];
            B[58][1] = v1;
            v1 = B[57][3];
            B[57][3] = B[59][1];
            B[59][1] = v1;
            v1 = B[58][3] ;
            B[58][3] = B[59][2];
            B[59][2] = v1;

            // 2nd block
            v1 = B[56][5];
            B[56][5] = B[57][4];
            B[57][4] = v1;
            v1 = B[56][6];
            B[56][6] = B[58][4];
            B[58][4] = v1;
            v1 = B[56][7];
            B[56][7] = B[59][4];
            B[59][4] = v1;
            v1 = B[57][6];
            B[57][6] = B[58][5];
            B[58][5] = v1;
            v1 = B[57][7];
            B[57][7] = B[59][5];
            B[59][5] = v1;
            v1 = B[58][7] ;
            B[58][7] = B[59][6];
            B[59][6] = v1;

            // 3rd block
            v1 = B[48][49];
            B[48][49] = B[49][48];
            B[49][48] = v1;
            v1 = B[48][50];
            B[48][50] = B[50][48];
            B[50][48] = v1;
            v1 = B[48][51];
            B[48][51] = B[51][48];
            B[51][48] = v1;
            v1 = B[49][50];
            B[49][50] = B[50][49];
            B[50][49] = v1;
            v1 = B[49][51];
            B[49][51] = B[51][49];
            B[51][49] = v1;
            v1 = B[50][51] ;
            B[50][51] = B[51][50];
            B[51][50] = v1;

            // 4th block
            v1 = B[48][53];
            B[48][53] = B[49][52];
            B[49][52] = v1;
            v1 = B[48][54];
            B[48][54] = B[50][52];
            B[50][52] = v1;
            v1 = B[48][55];
            B[48][55] = B[51][52];
            B[51][52] = v1;
            v1 = B[49][54];
            B[49][54] = B[50][53];
            B[50][53] = v1;
            v1 = B[49][55];
            B[49][55] = B[51][53];
            B[51][53] = v1;
            v1 = B[50][55] ;
            B[50][55] = B[51][54];
            B[51][54] = v1;

            // Move to B destination
            v1 = B[j][i+4]; v2 = B[j][i+5]; v3 = B[j][i+6]; v4 = B[j][i+7];  
            B[j][i+4] = B[48][48]; B[j][i+5] = B[48][49]; B[j][i+6] = B[48][50]; B[j][i+7] = B[48][51];
            B[48][48] = v1; B[48][49] = v2; B[48][50] = v3; B[48][51] = v4;

            v1 = B[j+1][i+4]; v2 = B[j+1][i+5]; v3 = B[j+1][i+6]; v4 = B[j+1][i+7]; 
            B[j+1][i+4] = B[49][48]; B[j+1][i+5] = B[49][49]; B[j+1][i+6] = B[49][50]; B[j+1][i+7] = B[49][51];
            B[49][48] = v1; B[49][49] = v2; B[49][50] = v3; B[49][51] = v4;

            v1 = B[j+2][i+4]; v2 = B[j+2][i+5]; v3 = B[j+2][i+6]; v4 = B[j+2][i+7]; 
            B[j+2][i+4] = B[50][48]; B[j+2][i+5] = B[50][49]; B[j+2][i+6] = B[50][50]; B[j+2][i+7] = B[50][51];
            B[50][48] = v1; B[50][49] = v2; B[50][50] = v3; B[50][51] = v4;
 
            v1 = B[j+3][i+4]; v2 = B[j+3][i+5]; v3 = B[j+3][i+6]; v4 = B[j+3][i+7]; 
            B[j+3][i+4] = B[51][48]; B[j+3][i+5] = B[51][49]; B[j+3][i+6] = B[51][50]; B[j+3][i+7] = B[51][51];
            B[51][48] = v1; B[51][49] = v2; B[51][50] = v3; B[51][51] = v4;
            // last 4 rows
            B[j+4][i]   = B[48][48]; B[j+4][i+1] = B[48][49]; B[j+4][i+2] = B[48][50]; B[j+4][i+3] = B[48][51];
            B[j+4][i+4] = B[48][52]; B[j+4][i+5] = B[48][53]; B[j+4][i+6] = B[48][54]; B[j+4][i+7] = B[48][55];
            B[j+5][i]   = B[49][48]; B[j+5][i+1] = B[49][49]; B[j+5][i+2] = B[49][50]; B[j+5][i+3] = B[49][51];
            B[j+5][i+4] = B[49][52]; B[j+5][i+5] = B[49][53]; B[j+5][i+6] = B[49][54]; B[j+5][i+7] = B[49][55];
            B[j+6][i]   = B[50][48]; B[j+6][i+1] = B[50][49]; B[j+6][i+2] = B[50][50]; B[j+6][i+3] = B[50][51];
            B[j+6][i+4] = B[50][52]; B[j+6][i+5] = B[50][53]; B[j+6][i+6] = B[50][54]; B[j+6][i+7] = B[50][55];
            B[j+7][i]   = B[51][48]; B[j+7][i+1] = B[51][49]; B[j+7][i+2] = B[51][50]; B[j+7][i+3] = B[51][51];
            B[j+7][i+4] = B[51][52]; B[j+7][i+5] = B[51][53]; B[j+7][i+6] = B[51][54]; B[j+7][i+7] = B[51][55];
        }


		for (i = 48; i < 56; i += block) {
            for(j = 48; j < 56; j += block) {
                    // row 1
                    v1 = A[i][j];
                    v2 = A[i][j+1];
                    v3 = A[i][j+2];
                    v4 = A[i][j+3];
                    v5 = A[i][j+4];
                    v6 = A[i][j+5];
                    v7 = A[i][j+6];			
                    v8 = A[i][j+7];
                    B[i][j] = v1;
                    B[i][j+1] = v2;
                    B[i][j+2] = v3;
                    B[i][j+3] = v4;
                    B[i][j+4] = v5;
                    B[i][j+5] = v6;
                    B[i][j+6] = v7;
                    B[i][j+7] = v8;

                    // row 2
                    v1 = A[i+1][j];
                    v2 = A[i+1][j+1];
                    v3 = A[i+1][j+2];
                    v4 = A[i+1][j+3];
                    v5 = A[i+1][j+4];
                    v6 = A[i+1][j+5];
                    v7 = A[i+1][j+6];			
                    v8 = A[i+1][j+7];
                    B[i+1][j] = v1;
                    B[i+1][j+1] = v2;
                    B[i+1][j+2] = v3;
                    B[i+1][j+3] = v4;
                    B[i+1][j+4] = v5;
                    B[i+1][j+5] = v6;
                    B[i+1][j+6] = v7;
                    B[i+1][j+7] = v8;

                    v1 = B[i+1][j];
                    B[i+1][j] = B[i][j+1];
                    B[i][j+1] = v1;

                    // row 3
                    v1 = A[i+2][j];
                    v2 = A[i+2][j+1];
                    v3 = A[i+2][j+2];
                    v4 = A[i+2][j+3];
                    v5 = A[i+2][j+4];
                    v6 = A[i+2][j+5];
                    v7 = A[i+2][j+6];			
                    v8 = A[i+2][j+7];
                    B[i+2][j] = v1;
                    B[i+2][j+1] = v2;
                    B[i+2][j+2] = v3;
                    B[i+2][j+3] = v4;
                    B[i+2][j+4] = v5;
                    B[i+2][j+5] = v6;
                    B[i+2][j+6] = v7;
                    B[i+2][j+7] = v8;

                    v1 = B[i+2][j];
                    v2 = B[i+2][j+1]; 
                    B[i+2][j] = B[i][j+2];
                    B[i+2][j+1] = B[i+1][j+2];
                    B[i][j+2] = v1;
                    B[i+1][j+2] = v2;

                    // row 4
                    v1 = A[i+3][j];
                    v2 = A[i+3][j+1];
                    v3 = A[i+3][j+2];
                    v4 = A[i+3][j+3];
                    v5 = A[i+3][j+4];
                    v6 = A[i+3][j+5];
                    v7 = A[i+3][j+6];			
                    v8 = A[i+3][j+7];
                    B[i+3][j] = v1;
                    B[i+3][j+1] = v2;
                    B[i+3][j+2] = v3;
                    B[i+3][j+3] = v4;
                    B[i+3][j+4] = v5;
                    B[i+3][j+5] = v6;
                    B[i+3][j+6] = v7;
                    B[i+3][j+7] = v8;

                    v1 = B[i+3][j];
                    v2 = B[i+3][j+1];
                    v3 = B[i+3][j+2]; 
                    B[i+3][j] = B[i][j+3];
                    B[i+3][j+1] = B[i+1][j+3];
                    B[i+3][j+2] = B[i+2][j+3];
                    B[i][j+3] = v1;
                    B[i+1][j+3] = v2;
                    B[i+2][j+3] = v3;

                    // row 5
                    v1 = A[i+4][j];
                    v2 = A[i+4][j+1];
                    v3 = A[i+4][j+2];
                    v4 = A[i+4][j+3];
                    v5 = A[i+4][j+4];
                    v6 = A[i+4][j+5];
                    v7 = A[i+4][j+6];			
                    v8 = A[i+4][j+7];
                    B[i+4][j] = v1;
                    B[i+4][j+1] = v2;
                    B[i+4][j+2] = v3;
                    B[i+4][j+3] = v4;
                    B[i+4][j+4] = v5;
                    B[i+4][j+5] = v6;
                    B[i+4][j+6] = v7;
                    B[i+4][j+7] = v8;


                    v1 = B[i+4][j];
                    v2 = B[i+4][j+1];
                    v3 = B[i+4][j+2];
                    v4 = B[i+4][j+3]; 
                    B[i+4][j] = B[i][j+4];
                    B[i+4][j+1] = B[i+1][j+4];
                    B[i+4][j+2] = B[i+2][j+4];
                    B[i+4][j+3] = B[i+3][j+4];
                    B[i][j+4] = v1;
                    B[i+1][j+4] = v2;
                    B[i+2][j+4] = v3;
                    B[i+3][j+4] = v4;

                    // row 6
                    v1 = A[i+5][j];
                    v2 = A[i+5][j+1];
                    v3 = A[i+5][j+2];
                    v4 = A[i+5][j+3];
                    v5 = A[i+5][j+4];
                    v6 = A[i+5][j+5];
                    v7 = A[i+5][j+6];			
                    v8 = A[i+5][j+7];
                    B[i+5][j] = v1;
                    B[i+5][j+1] = v2;
                    B[i+5][j+2] = v3;
                    B[i+5][j+3] = v4;
                    B[i+5][j+4] = v5;
                    B[i+5][j+5] = v6;
                    B[i+5][j+6] = v7;
                    B[i+5][j+7] = v8;


                    v1 = B[i+5][j];
                    v2 = B[i+5][j+1];
                    v3 = B[i+5][j+2];
                    v4 = B[i+5][j+3]; 
                    v5 = B[i+5][j+4];  
                    B[i+5][j] = B[i][j+5];
                    B[i+5][j+1] = B[i+1][j+5];
                    B[i+5][j+2] = B[i+2][j+5];
                    B[i+5][j+3] = B[i+3][j+5];
                    B[i+5][j+4] = B[i+4][j+5];
                    B[i][j+5] = v1;
                    B[i+1][j+5] = v2;
                    B[i+2][j+5] = v3;
                    B[i+3][j+5] = v4;
                    B[i+4][j+5] = v5; 

                    // row 7
                    v1 = A[i+6][j];
                    v2 = A[i+6][j+1];
                    v3 = A[i+6][j+2];
                    v4 = A[i+6][j+3];
                    v5 = A[i+6][j+4];
                    v6 = A[i+6][j+5];
                    v7 = A[i+6][j+6];			
                    v8 = A[i+6][j+7];
                    B[i+6][j] = v1;
                    B[i+6][j+1] = v2;
                    B[i+6][j+2] = v3;
                    B[i+6][j+3] = v4;
                    B[i+6][j+4] = v5;
                    B[i+6][j+5] = v6;
                    B[i+6][j+6] = v7;
                    B[i+6][j+7] = v8;

                    v1 = B[i+6][j];
                    v2 = B[i+6][j+1];
                    v3 = B[i+6][j+2];
                    v4 = B[i+6][j+3]; 
                    v5 = B[i+6][j+4];
                    v6 = B[i+6][j+5]; 
                    B[i+6][j] = B[i][j+6];
                    B[i+6][j+1] = B[i+1][j+6];
                    B[i+6][j+2] = B[i+2][j+6];
                    B[i+6][j+3] = B[i+3][j+6];
                    B[i+6][j+4] = B[i+4][j+6];
                    B[i+6][j+5] = B[i+5][j+6];
                    B[i][j+6] = v1;
                    B[i+1][j+6] = v2;
                    B[i+2][j+6] = v3;
                    B[i+3][j+6] = v4;
                    B[i+4][j+6] = v5;
                    B[i+5][j+6] = v6;  

                    // row 8
                    v1 = A[i+7][j];
                    v2 = A[i+7][j+1];
                    v3 = A[i+7][j+2];
                    v4 = A[i+7][j+3];
                    v5 = A[i+7][j+4];
                    v6 = A[i+7][j+5];
                    v7 = A[i+7][j+6];			
                    v8 = A[i+7][j+7];
                    B[i+7][j] = v1;
                    B[i+7][j+1] = v2;
                    B[i+7][j+2] = v3;
                    B[i+7][j+3] = v4;
                    B[i+7][j+4] = v5;
                    B[i+7][j+5] = v6;
                    B[i+7][j+6] = v7;
                    B[i+7][j+7] = v8;

                    v1 = B[i+7][j];
                    v2 = B[i+7][j+1];
                    v3 = B[i+7][j+2];
                    v4 = B[i+7][j+3]; 
                    v5 = B[i+7][j+4];
                    v6 = B[i+7][j+5];
                    v7 = B[i+7][j+6];
                    B[i+7][j] = B[i][j+7];
                    B[i+7][j+1] = B[i+1][j+7];
                    B[i+7][j+2] = B[i+2][j+7];
                    B[i+7][j+3] = B[i+3][j+7];
                    B[i+7][j+4] = B[i+4][j+7];
                    B[i+7][j+5] = B[i+5][j+7];
                    B[i+7][j+6] = B[i+6][j+7];
                    B[i][j+7] = v1;
                    B[i+1][j+7] = v2;
                    B[i+2][j+7] = v3;
                    B[i+3][j+7] = v4;
                    B[i+4][j+7] = v5;
                    B[i+5][j+7] = v6;
                    B[i+6][j+7] = v7;     
            }
        }
    }

    if (M == 61) {
        int i, j, tmp, i1, j1;
        int block = 17; // The size of each block is 32 bytes (8 int)

        for (i = 0; i < N; i+=block) {
            for (j = 0; j < M; j+=block) {
                for (i1 = i; i1 < i + block; i1++) {
                    for (j1 = j; j1 < j + block; j1++) {
                        if (i1 < N && j1 < M) {
                            tmp = A[i1][j1];
                            B[j1][i1] = tmp;
                        }
                    }
                }
            }
        }     
    }

}




/* 
 * You can define additional transpose functions below. We've defined
 * a simple one below to help you get started. 
 */ 

/* 
 * trans - A simple baseline transpose function, not optimized for the cache.
 */
char trans_desc[] = "Simple row-wise scan transpose";
void trans(int M, int N, int A[N][M], int B[M][N])
{
    int i, j, tmp;

    for (i = 0; i < N; i++) {
        for (j = 0; j < M; j++) {
            tmp = A[i][j];
            B[j][i] = tmp;
        }
    }    

}

/*
 * registerFunctions - This function registers your transpose
 *     functions with the driver.  At runtime, the driver will
 *     evaluate each of the registered functions and summarize their
 *     performance. This is a handy way to experiment with different
 *     transpose strategies.
 */
void registerFunctions()
{
    /* Register your solution function */
    registerTransFunction(transpose_submit, transpose_submit_desc); 
}

/* 
 * is_transpose - This helper function checks if B is the transpose of
 *     A. You can check the correctness of your transpose by calling
 *     it before returning from the transpose function.
 */
int is_transpose(int M, int N, int A[N][M], int B[M][N])
{
    int i, j;

    for (i = 0; i < N; i++) {
        for (j = 0; j < M; ++j) {
            if (A[i][j] != B[j][i]) {
                return 0;
            }
        }
    }
    return 1;
}

